<!-- public/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Random Fractal Visualization</title>
  <style>
    body { margin: 0; background: black; }
    canvas { display: block; }
    #overlay {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="overlay"></div>
  <canvas id="visualization"></canvas>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const canvas = document.getElementById('visualization');
    const context = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const width = window.innerWidth;
    const height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let previousImageData = null;

    socket.on('update', (data) => {
      const { gridResolution, predictions, c } = data;
      const imageData = context.createImageData(gridResolution, gridResolution);
      const buffer = new Uint8ClampedArray(gridResolution * gridResolution * 4);

      for (let i = 0; i < predictions.length; i++) {
        const predValue = predictions[i];
        const color = predValue * 255;
        buffer[i * 4] = color;        // R
        buffer[i * 4 + 1] = 0;        // G
        buffer[i * 4 + 2] = 255 - color;  // B
        buffer[i * 4 + 3] = 255;      // A
      }

      imageData.data.set(buffer);
      context.putImageData(imageData, 0, 0, 0, 0, width, height);

      // Display epoch, metrics, and parameter 'c'
      overlay.innerHTML = `
        <div>Julia Set with c = ${c.re.toFixed(4)} + ${c.im.toFixed(4)}i</div>
        <div>Epoch: ${data.epoch}/${data.totalEpochs}</div>
        <div>Loss: ${data.logs.loss.toFixed(4)}</div>
        <div>Accuracy: ${(data.logs.acc || data.logs.accuracy).toFixed(4)}</div>
      `;
    });
  </script>
</body>
</html>
